generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Customer {
  id               Int               @id @default(autoincrement())
  name             String
  name_normalized  String

  customerProducts CustomerProduct[]
  orders           Order[]

  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  deletedAt        DateTime?
}

model Product {
  id               Int               @id @default(autoincrement())
  name             String
  name_normalized  String

  customerProducts CustomerProduct[]
  orderProducts    OrderProduct[]

  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  deletedAt        DateTime?
}

model CustomerProduct {
  id         Int      @id @default(autoincrement())
  customerId Int
  productId  Int

  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([customerId, productId])
}

model Order {
  id            Int           @id @default(autoincrement())
  customerId    Int
  customer      Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)

  orderDate     DateTime
  deliveryDate  DateTime?
  comment       String?

  orderProducts OrderProduct[]

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  deletedAt     DateTime?
}

model OrderProduct {
  id          Int      @id @default(autoincrement())
  orderId     Int
  productId   Int

  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  productName String
  quantity    Int      @default(1)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([orderId, productId])
}